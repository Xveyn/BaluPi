import{u as pe,c as Q,f as Ie,d as A,j as e,e as D,g as L,h as Re,i as Pe,_ as ie}from"./index-di5tIgDA.js";import{a as c,u as I,d as Fe}from"./vendor-react-ZzjCT2KX.js";import{g as Ue,S as Y,a as We,p as ce,l as Oe,b as He}from"./monitoring-BvpkCkhO.js";import{u as R}from"./vendor-i18n-DuW_MkEn.js";import{Z as K,g as ee,F as te,h as ze,i as Be,M as Ve,U as Ke,j as qe,T as Je,D as Ye,k as Ge,l as Xe,m as fe,c as ae,n as ge,o as Ze,p as q,P as G,W as se,q as be,A as Qe,r as et,E as tt,s as st,t as at,u as rt,b as ve,X as oe,H as je,v as nt,w as lt,d as it}from"./vendor-icons-eCvzHHv5.js";import"./vendor-charts-Dce8K_o7.js";const ct=s=>{if(typeof s=="number")return s;if(typeof s=="string"){const t=s.replace(/[^0-9.]/g,""),a=Number.parseFloat(t);return Number.isFinite(a)?a:0}return 0},we="system_telemetry_cache",ot=12e4;function dt(){try{const s=sessionStorage.getItem(we);if(s){const t=JSON.parse(s);if(Date.now()-(t.timestamp||0)<ot)return{system:t.system,storage:t.storage,history:t.history}}}catch{}return null}function mt(s,t,a){try{sessionStorage.setItem(we,JSON.stringify({system:s,storage:t,history:a,timestamp:Date.now()}))}catch{}}const xt=(s=5e3)=>{const{token:t}=pe(),a=dt(),[n,o]=c.useState(a?.system||null),[h,f]=c.useState(a?.storage||null),[i,x]=c.useState(!a),[m,p]=c.useState(!1),[l,d]=c.useState(null),[g,j]=c.useState(null),[w,_]=c.useState(a?.history||{cpu:[],memory:[],network:[]}),u=c.useRef(null);c.useEffect(()=>{if(!t)return d("Missing authentication token."),x(!1),()=>{};let y=!0;const T=async(E=!1)=>{try{!E&&(n||a)?p(!0):d(null);const[k,P,W]=await Promise.all([fetch(Q("/api/system/info"),{headers:{Authorization:`Bearer ${t}`}}),fetch(Q("/api/system/storage/aggregated"),{headers:{Authorization:`Bearer ${t}`}}),fetch(Q("/api/system/telemetry/history"),{headers:{Authorization:`Bearer ${t}`}})]);if(k.status===401||P.status===401||W.status===401){Ie();return}if(!k.ok)throw new Error("Failed to fetch system info");if(!P.ok)throw new Error("Failed to fetch storage info");if(!W.ok)throw new Error("Failed to fetch telemetry history");const U=await k.json(),O=await P.json(),z=await W.json();if(!y)return;o(U),f(O),_(z),mt(U,O,z),j(new Date),x(!1),p(!1)}catch(k){if(!y)return;const P=k instanceof Error?k.message:"Unexpected telemetry error";d(P),x(!1),p(!1)}};return a?(x(!1),T(!1)):T(!0),u.current=window.setInterval(()=>{T(!1)},s),()=>{y=!1,u.current&&window.clearInterval(u.current)}},[s,t]);const N=c.useMemo(()=>{if(!h)return null;const y=Number(h.total)||0,T=Number(h.used)||0,E=Number(h.available)||Math.max(y-T,0),k=y?T/y*100:ct(h.usePercent);return{...h,total:y,used:T,available:E,percent:Math.min(Math.max(k,0),100)}},[h]);return{system:n,storage:N,loading:i,refreshing:m,error:l,lastUpdated:g,history:w}};async function Ne(){const{data:s}=await A.get("/api/system/smart/status");return s}async function ut(){const{data:s}=await A.get("/api/system/smart/mode");return s}async function ht(){const{data:s}=await A.post("/api/system/smart/toggle-mode");return s}const de=Object.freeze(Object.defineProperty({__proto__:null,fetchSmartStatus:Ne,getSmartMode:ut,toggleSmartMode:ht},Symbol.toStringTag,{value:"Module"})),ye="smart_data_cache",ke="smart_data_cache_timestamp",pt=300*1e3;function ft(){try{const s=localStorage.getItem(ye),t=localStorage.getItem(ke);if(s&&t&&Date.now()-parseInt(t)<pt)return JSON.parse(s)}catch{}return null}function gt(s){try{localStorage.setItem(ye,JSON.stringify(s)),localStorage.setItem(ke,Date.now().toString())}catch{}}function bt(s=6e4){const t=ft(),[a,n]=c.useState(t),[o,h]=c.useState(!t),[f,i]=c.useState(null),[x,m]=c.useState(null),p=async()=>{try{const d=await Ne();n(d),gt(d),i(null),m(new Date),h(!1)}catch(d){i(d instanceof Error?d.message:"Fehler beim Laden der SMART-Daten"),h(!1)}};return c.useEffect(()=>{let d=!0,g;const j=()=>{(!t||!d)&&p(),g=window.setTimeout(j,s)};return j(),()=>{d=!1,g!==void 0&&clearTimeout(g)}},[s]),{smartData:a,loading:o,error:f,lastUpdated:x,refetch:()=>{h(!0),p()}}}const vt=async()=>{const{data:s}=await A.get("/api/system/raid/status");return s};async function jt(){const{data:s}=await A.get("/api/system/mode");return s}async function wt(){return(await A.get("/api/schedulers")).data}async function Nt(s,t=!1){return(await A.post(`/api/schedulers/${s}/run-now`,{force:t})).data}async function yt(s,t){return(await A.put(`/api/schedulers/${s}/config`,t)).data}async function kt(s,t){return(await A.post(`/api/schedulers/${s}/toggle`,{enabled:t})).data}function me(s){switch(s){case"raid_scrub":return"ðŸ’¾";case"smart_scan":return"ðŸ”";case"backup":return"ðŸ“¦";case"sync_check":return"ðŸ”„";case"notification_check":return"ðŸ””";case"upload_cleanup":return"ðŸ§¹";default:return"â°"}}const _t=3e4,xe=3e3;function St(s={}){const{refreshInterval:t=3e4,enabled:a=!0,pauseRefresh:n=!1}=s,[o,h]=c.useState(null),[f,i]=c.useState(!0),[x,m]=c.useState(null),[p,l]=c.useState(!1),d=c.useRef(0),g=c.useCallback(async()=>{try{const u=await wt();h(u),m(null)}catch(u){const N=u!=null&&typeof u=="object"&&"response"in u?u.response?.data?.detail:void 0;m(N||(u instanceof Error?u.message:"Failed to load schedulers"))}},[]);c.useEffect(()=>{!a||p||(i(!0),g().finally(()=>{i(!1),l(!0)}))},[a,p,g]),c.useEffect(()=>{if(!a||!p||n)return;const u=()=>{const k=Date.now()<d.current?xe:t;k<=0||(g(),y=window.setTimeout(u,k))},N=Date.now()<d.current?xe:t;let y=window.setTimeout(u,N);return()=>window.clearTimeout(y)},[a,p,t,n,g]);const j=c.useCallback(async(u,N=!1)=>{const y=await Nt(u,N);return y.success&&(d.current=Date.now()+_t),await g(),y},[g]),w=c.useCallback(async(u,N)=>{const y=await kt(u,N);return await g(),y},[g]),_=c.useCallback(async(u,N)=>{try{return await yt(u,N),await g(),!0}catch{return!1}},[g]);return{schedulers:o?.schedulers||[],totalRunning:o?.total_running||0,totalEnabled:o?.total_enabled||0,loading:f,error:x,refetch:g,runNow:j,toggle:w,updateConfig:_}}function _e(s={}){const{refreshInterval:t=6e4,enabled:a=!0}=s,{schedulers:n,loading:o,error:h,refetch:f}=St({refreshInterval:t,enabled:a});return{nextMaintenance:c.useMemo(()=>{if(!n||n.length===0)return null;const x=new Date;let m=null;for(const p of n){if(!p.is_enabled||!p.next_run_at)continue;const l=new Date(p.next_run_at),d=l<x;(!m||l<m.nextRunAt)&&(m={scheduler:p,nextRunAt:l,isOverdue:d})}return m},[n]),allSchedulers:n,loading:o,error:h,refetch:f}}function $t(s){const t=new Date,a=s.getTime()-t.getTime(),n=Math.floor(a/(1e3*60)),o=Math.floor(n/60),h=Math.floor(o/24);return a<0?"Overdue":n<60?`in ${n} min`:o<24?`in ${o}h`:h<7?`in ${h} day${h===1?"":"s"}`:s.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"})}function Mt(s){const t=s.toLocaleDateString(void 0,{weekday:"long"}),a=s.toLocaleDateString(void 0,{day:"numeric",month:"short"}),n=s.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"});return`${t} - ${a} - ${n}`}function Se(s={}){const{refreshInterval:t=3e4,enabled:a=!0}=s,[n,o]=c.useState([]),[h,f]=c.useState(!0),[i,x]=c.useState(null),m=c.useCallback(async()=>{try{const l=await Ue();o(l.services),x(null)}catch(l){const d=l!=null&&typeof l=="object"&&"response"in l?l.response?.data?.detail:void 0;x(d||(l instanceof Error?l.message:"Failed to load services"))}},[]);return c.useEffect(()=>{a&&(f(!0),m().finally(()=>f(!1)))},[a,m]),c.useEffect(()=>{if(!a||t<=0)return;const l=setInterval(m,t);return()=>clearInterval(l)},[a,t,m]),{summary:c.useMemo(()=>({running:n.filter(l=>l.state===Y.RUNNING).length,stopped:n.filter(l=>l.state===Y.STOPPED).length,error:n.filter(l=>l.state===Y.ERROR).length,disabled:n.filter(l=>l.state===Y.DISABLED).length,total:n.length}),[n]),services:n,loading:h,error:i,refetch:m}}function ue(s,t={}){const{refreshInterval:a,enabled:n=!0}=t,[o,h]=c.useState(null),[f,i]=c.useState(!0),[x,m]=c.useState(null),p=c.useRef(s);p.current=s;const l=c.useCallback(async()=>{try{i(!0),m(null);const d=await p.current();h(d)}catch(d){const g=d instanceof Error?d.message:"An error occurred";m(g)}finally{i(!1)}},[]);return c.useEffect(()=>{if(!n){i(!1);return}if(l(),a&&a>0){const d=setInterval(l,a);return()=>clearInterval(d)}},[l,n,a]),{data:o,loading:f,error:x,refetch:l}}async function Ct(){return(await A.get("/api/fans/status")).data}async function Dt(){return(await A.get("/api/power/status")).data}function Tt({raidData:s,schedulers:t,isAdmin:a}){const{data:n}=ue(Ct,{refreshInterval:3e4,enabled:a}),{data:o}=ue(Dt,{refreshInterval:15e3,enabled:a});return{activities:c.useMemo(()=>{const f=[];for(const i of t)i.is_running&&f.push({id:`scheduler-${i.name}`,type:"scheduler_running",label:"liveActivities.schedulerRunning",labelParams:{name:i.display_name},icon:"clock",link:"/schedulers",level:"info"});if(n)for(const i of n.fans)i.mode==="scheduled"&&i.active_schedule&&f.push({id:`fan-${i.fan_id}`,type:"fan_scheduled",label:"liveActivities.fanScheduled",labelParams:{name:i.active_schedule.name,until:i.active_schedule.end_time},icon:"wind",link:"/system?tab=fans",level:"info"});if(s){for(const i of s.arrays)if(i.resync_progress!=null&&i.resync_progress<100){const x=i.status==="rebuilding"?"rebuild":"check";f.push({id:`raid-${i.name}`,type:"raid_resync",label:"liveActivities.raidResync",labelParams:{name:i.name,action:x,progress:Math.round(i.resync_progress)},progress:i.resync_progress,icon:"hard-drive",link:"/raid",level:x==="rebuild"?"warning":"info"})}}if(o){const i=o.active_demands.filter(x=>x.level==="medium"||x.level==="surge");if(i.length>0){const x=i.find(m=>m.level==="surge")||i[0];f.push({id:"power-elevated",type:"power_elevated",label:"liveActivities.powerElevated",labelParams:{profile:x.level.charAt(0).toUpperCase()+x.level.slice(1),source:x.source},icon:"zap",link:"/system?tab=power",level:x.level==="surge"?"warning":"info"})}}return f},[t,n,s,o])}}const Et=5e3;function At(){const[s,t]=c.useState(null),[a,n]=c.useState(!0),[o,h]=c.useState(null),[f,i]=c.useState(null),x=c.useCallback(async()=>{try{const m=await We();t(m),h(null),i(new Date)}catch(m){h(m instanceof Error?m.message:"Failed to fetch power data")}finally{n(!1)}},[]);return c.useEffect(()=>{x();const m=setInterval(()=>{x()},Et);return()=>{clearInterval(m)}},[x]),{data:s,loading:a,error:o,lastUpdated:f,refetch:x}}const Lt=()=>{const{t:s}=R("system"),t=I(),{data:a,loading:n,error:o}=At(),h=()=>t("/system?tab=power"),f=a?.total_current_power||0,i=a?.devices||[],m=i.flatMap(u=>u.samples).sort((u,N)=>ce(u.timestamp).getTime()-ce(N.timestamp).getTime()).slice(-30);let p=0;if(m.length>=10){const u=m.slice(-5),N=m.slice(-10,-5),y=u.reduce((E,k)=>E+k.watts,0)/u.length,T=N.reduce((E,k)=>E+k.watts,0)/N.length;p=y-T}const l=i.reduce((u,N)=>{const y=N.latest_sample;return u+(y?.energy_today||0)},0),g=Math.abs(p)<1?{label:s("powerWidget.stable"),tone:"steady"}:p>0?{label:`+${D(p,1)}W`,tone:"increase"}:{label:`${D(p,1)}W`,tone:"decrease"},j=g.tone==="decrease"?"text-emerald-400":g.tone==="increase"?"text-rose-300":"text-slate-400",_=Math.min(f/150*100,100);return n?e.jsx("div",{className:"card border-slate-800/40 bg-slate-900/60",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:s("powerWidget.title")}),e.jsx("p",{className:"mt-2 text-2xl sm:text-3xl font-semibold text-slate-400",children:s("powerWidget.loading")})]}),e.jsx("div",{className:"flex h-11 w-11 sm:h-12 sm:w-12 shrink-0 items-center justify-center rounded-2xl bg-gradient-to-br from-amber-500 to-orange-500 text-white shadow-[0_12px_38px_rgba(251,146,60,0.35)]",children:e.jsx(K,{className:"h-6 w-6"})})]})}):o||!a?e.jsxs("div",{className:"card border-slate-800/40 bg-slate-900/60",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:s("powerWidget.title")}),e.jsx("p",{className:"mt-2 text-2xl sm:text-3xl font-semibold text-slate-400",children:s("powerWidget.offline")})]}),e.jsx("div",{className:"flex h-11 w-11 sm:h-12 sm:w-12 shrink-0 items-center justify-center rounded-2xl bg-slate-800 text-slate-500",children:e.jsx(K,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"mt-3 sm:mt-4 flex items-center justify-between gap-2 text-xs text-slate-400",children:e.jsx("span",{className:"truncate",children:s("powerWidget.noDevices")})})]}):i.length===0?e.jsxs("div",{className:"card border-slate-800/40 bg-slate-900/60",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:s("powerWidget.title")}),e.jsx("p",{className:"mt-2 text-2xl sm:text-3xl font-semibold text-slate-400",children:"â€”"})]}),e.jsx("div",{className:"flex h-11 w-11 sm:h-12 sm:w-12 shrink-0 items-center justify-center rounded-2xl bg-slate-800 text-slate-500",children:e.jsx(K,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"mt-3 sm:mt-4 flex items-center justify-between gap-2 text-xs text-slate-400",children:e.jsx("span",{className:"truncate",children:s("powerWidget.configureInSettings")})})]}):e.jsxs("div",{onClick:h,className:"card border-slate-800/40 bg-slate-900/60 transition-all duration-200 hover:border-slate-700/60 hover:bg-slate-900/80 hover:shadow-[0_14px_44px_rgba(251,146,60,0.15)] active:scale-[0.98] touch-manipulation cursor-pointer",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:s("powerWidget.title")}),e.jsxs("p",{className:"mt-2 text-2xl sm:text-3xl font-semibold text-white truncate",children:[D(f,1)," W"]})]}),e.jsx("div",{className:"flex h-11 w-11 sm:h-12 sm:w-12 shrink-0 items-center justify-center rounded-2xl bg-gradient-to-br from-amber-500 to-orange-500 text-white shadow-[0_12px_38px_rgba(251,146,60,0.35)]",children:e.jsx(K,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"mt-3 sm:mt-4 flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs text-slate-400",children:[e.jsxs("span",{className:"truncate flex-1 min-w-0",children:[s("powerWidget.energyToday"),": ",D(l,2)," kWh"]}),e.jsx("span",{className:`${j} shrink-0`,children:g.label})]}),e.jsxs("div",{className:"text-xs text-slate-500 truncate",children:[i.length," ",i.length===1?s("powerWidget.device"):s("powerWidget.devices")," ",s("powerWidget.monitored")]})]}),e.jsx("div",{className:"mt-4 sm:mt-5 h-2 w-full overflow-hidden rounded-full bg-slate-800",children:e.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-amber-500 to-orange-500 transition-all duration-500",style:{width:`${Math.min(Math.max(_,0),100)}%`}})})]})};function It(s){switch(s.toLowerCase()){case"upload":return"upload";case"download":return"download";case"delete":return"delete";case"create":case"mkdir":return"create";case"login":case"auth":return"user";case"move":case"rename":return"move";case"copy":return"copy";case"share":return"share";default:return"file"}}function Rt(s){switch(s.toLowerCase()){case"upload":return"File Uploaded";case"download":return"File Downloaded";case"delete":return"File Deleted";case"create":case"mkdir":return"Created";case"login":return"User Login";case"auth":return"Authentication";case"move":return"File Moved";case"rename":return"File Renamed";case"copy":return"File Copied";case"share":return"File Shared";default:return s.charAt(0).toUpperCase()+s.slice(1)}}function Pt(s){const a=new Date().getTime()-s.getTime(),n=Math.floor(a/1e3),o=Math.floor(n/60),h=Math.floor(o/60),f=Math.floor(h/24);return n<60?"just now":o<60?`${o} minute${o===1?"":"s"} ago`:h<24?`${h} hour${h===1?"":"s"} ago`:f<7?`${f} day${f===1?"":"s"} ago`:s.toLocaleDateString()}function Ft(s,t){const a=new Date(s.timestamp),n=s.resource||"";let h=n.split("/").pop()||n||s.resource;return s.user&&s.user!=="unknown"&&(h=`${s.user} â€¢ ${h}`),s.details?.size_bytes&&(h+=` (${L(s.details.size_bytes)})`),{id:`${s.timestamp}-${t}`,title:Rt(s.action),detail:h,ago:Pt(a),icon:It(s.action),timestamp:a,success:s.success}}function Ut(s={}){const{limit:t=5,days:a=1,refreshInterval:n=3e4}=s,[o,h]=c.useState([]),[f,i]=c.useState(!0),[x,m]=c.useState(null),p=c.useCallback(async()=>{try{const d=(await Oe.getFileAccessLogs({limit:t,days:a})).logs.map((g,j)=>Ft(g,j));h(d),m(null)}catch(l){const d=l!=null&&typeof l=="object"&&"response"in l?l.response?.data?.detail:void 0;m(d||(l instanceof Error?l.message:"Failed to load activity feed"))}},[t,a]);return c.useEffect(()=>{i(!0),p().finally(()=>i(!1))},[p]),c.useEffect(()=>{if(n<=0)return;const l=setInterval(p,n);return()=>clearInterval(l)},[n,p]),{activities:o,loading:f,error:x,refetch:p}}function Wt({type:s,success:t}){const a=t?"text-sky-400":"text-rose-400";return{upload:e.jsx(Ge,{className:`h-4 w-4 ${a}`}),download:e.jsx(Ye,{className:`h-4 w-4 ${a}`}),delete:e.jsx(Je,{className:`h-4 w-4 ${a}`}),create:e.jsx(qe,{className:`h-4 w-4 ${a}`}),user:e.jsx(Ke,{className:`h-4 w-4 ${a}`}),move:e.jsx(Ve,{className:`h-4 w-4 ${a}`}),copy:e.jsx(Be,{className:`h-4 w-4 ${a}`}),share:e.jsx(ze,{className:`h-4 w-4 ${a}`}),file:e.jsx(te,{className:`h-4 w-4 ${a}`})}[s]||e.jsx(te,{className:`h-4 w-4 ${a}`})}const Ot=({limit:s=5})=>{const{t}=R(["dashboard","common"]),a=I(),{activities:n,loading:o,error:h}=Ut({limit:s,days:1}),f=()=>{a("/logging")};return e.jsxs("div",{className:"card border-slate-800/50 bg-slate-900/55",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:t("dashboard:activity.title")}),e.jsx("h2",{className:"mt-2 text-xl font-semibold text-white",children:t("dashboard:activity.liveOperations")})]}),e.jsx("button",{onClick:f,className:"rounded-full border border-slate-700/70 px-3 py-1 text-xs text-slate-400 transition hover:border-slate-500 hover:text-white",children:t("dashboard:activity.viewSystemLogs")})]}),e.jsx("div",{className:"mt-6 space-y-4",children:o?e.jsx("div",{className:"flex flex-col gap-3",children:[1,2,3].map(i=>e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-slate-800 bg-slate-900/70 px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-9 w-9 rounded-xl bg-slate-800 animate-pulse"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-slate-800 animate-pulse"}),e.jsx("div",{className:"h-3 w-48 rounded bg-slate-800/50 animate-pulse"})]})]}),e.jsx("div",{className:"h-3 w-16 rounded bg-slate-800/50 animate-pulse"})]},i))}):h?e.jsxs("div",{className:"flex items-center gap-3 rounded-2xl border border-rose-500/30 bg-rose-500/10 px-4 py-4 text-rose-200",children:[e.jsx(ee,{className:"h-5 w-5 shrink-0"}),e.jsx("span",{className:"text-sm",children:t("dashboard:activity.failedToLoad",{error:h})})]}):n.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-2xl border border-slate-800 bg-slate-900/70 px-4 py-8 text-center",children:[e.jsx(te,{className:"h-8 w-8 text-slate-600 mb-2"}),e.jsx("p",{className:"text-sm text-slate-400",children:t("dashboard:activity.noRecentActivity")}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:t("dashboard:activity.operationsAppearHere")})]}):n.map(i=>e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-slate-800 bg-slate-900/70 px-4 py-3 transition hover:border-sky-500/30",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`flex h-9 w-9 items-center justify-center rounded-xl ${i.success?"bg-slate-950/70":"bg-rose-950/50"}`,children:e.jsx(Wt,{type:i.icon,success:i.success})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-100",children:i.title}),e.jsx("p",{className:"text-xs text-slate-500 truncate max-w-[250px] sm:max-w-[350px]",children:i.detail})]})]}),e.jsx("span",{className:"text-xs text-slate-500 shrink-0 ml-2",children:i.ago})]},i.id))})]})},Ht=({showAllSchedulers:s=!1})=>{const{t}=R(["dashboard","common"]),a=I(),{nextMaintenance:n,allSchedulers:o,loading:h,error:f}=_e(),i=()=>{a("/schedulers")},x=g=>{switch(g){case"completed":return e.jsx(Ze,{className:"h-3.5 w-3.5 text-emerald-400"});case"failed":return e.jsx(ge,{className:"h-3.5 w-3.5 text-rose-400"});case"running":return e.jsx(ae,{className:"h-3.5 w-3.5 text-sky-400 animate-pulse"});default:return null}};if(h)return e.jsxs("div",{className:"card border-slate-800/50 bg-gradient-to-br from-slate-900/70 via-slate-900/40 to-slate-950/80",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500",children:t("dashboard:maintenance.title")}),e.jsx("div",{className:"mt-2 h-6 w-48 rounded bg-slate-800 animate-pulse"}),e.jsx("div",{className:"mt-3 h-4 w-64 rounded bg-slate-800/50 animate-pulse"}),e.jsx("div",{className:"mt-4 rounded-xl border border-slate-800 bg-slate-900/70 px-4 py-3",children:e.jsx("div",{className:"h-4 w-32 rounded bg-slate-800/50 animate-pulse"})})]});if(f)return e.jsxs("div",{className:"card border-slate-800/50 bg-gradient-to-br from-slate-900/70 via-slate-900/40 to-slate-950/80",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500",children:t("dashboard:maintenance.title")}),e.jsx("h3",{className:"mt-2 text-lg font-semibold text-slate-400",children:t("dashboard:maintenance.unableToLoad")}),e.jsx("p",{className:"mt-3 text-sm text-rose-300",children:f})]});if(!n)return e.jsxs("div",{className:"card border-slate-800/50 bg-gradient-to-br from-slate-900/70 via-slate-900/40 to-slate-950/80",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500",children:t("dashboard:maintenance.title")}),e.jsx("h3",{className:"mt-2 text-lg font-semibold text-slate-400",children:t("dashboard:maintenance.noScheduledTasks")}),e.jsx("p",{className:"mt-3 text-sm text-slate-500",children:t("dashboard:maintenance.allDisabled")}),e.jsxs("div",{className:"mt-4 flex items-center justify-between rounded-xl border border-slate-800 bg-slate-900/70 px-4 py-3 text-sm text-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-4 w-4 text-slate-500"}),e.jsx("span",{className:"text-slate-400",children:t("dashboard:maintenance.configureSchedulers")})]}),e.jsx("button",{onClick:i,className:"rounded-full border border-slate-700/70 px-3 py-1 text-xs text-slate-400 transition hover:border-slate-500 hover:text-white",children:t("dashboard:maintenance.manage")})]})]});const{scheduler:m,nextRunAt:p,isOverdue:l}=n,d=me(m.name);return e.jsxs("div",{className:"card border-slate-800/50 bg-gradient-to-br from-slate-900/70 via-slate-900/40 to-slate-950/80",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500",children:t("dashboard:maintenance.title")}),e.jsxs("h3",{className:"mt-2 text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx("span",{children:d}),m.display_name]})]}),l&&e.jsxs("div",{className:"flex items-center gap-1 rounded-full bg-amber-500/20 px-2 py-0.5",children:[e.jsx(fe,{className:"h-3 w-3 text-amber-400"}),e.jsx("span",{className:"text-xs text-amber-300",children:t("dashboard:maintenance.overdue")})]})]}),e.jsx("p",{className:"mt-3 text-sm text-slate-400",children:m.description}),m.last_status&&e.jsxs("div",{className:"mt-2 flex items-center gap-1.5 text-xs text-slate-500",children:[x(m.last_status),e.jsxs("span",{children:["Last run: ",m.last_status,m.last_duration_ms&&` (${D(m.last_duration_ms/1e3,1)}s)`]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between rounded-xl border border-slate-800 bg-slate-900/70 px-4 py-3 text-sm text-slate-300",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.25em] text-slate-500",children:t("dashboard:maintenance.window")}),e.jsx("p",{className:"mt-1 text-sm text-slate-200",children:Mt(p)}),e.jsx("p",{className:"text-xs text-slate-500 mt-0.5",children:$t(p)})]}),e.jsx("button",{onClick:i,className:"rounded-full border border-slate-700/70 px-3 py-1 text-xs text-slate-400 transition hover:border-slate-500 hover:text-white",children:t("dashboard:maintenance.viewPlan")})]}),s&&o.length>1&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-800/50",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:t("dashboard:maintenance.schedulersTotal",{count:o.length})}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[o.slice(0,4).map(g=>e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs ${g.is_enabled?"bg-slate-800 text-slate-300":"bg-slate-900 text-slate-500"}`,children:[e.jsx("span",{children:me(g.name)}),g.display_name.split(" ")[0]]},g.name)),o.length>4&&e.jsxs("span",{className:"text-xs text-slate-500",children:["+",o.length-4," more"]})]})]})]})},zt=({isAdmin:s,className:t=""})=>{const{t:a}=R(["dashboard","common"]),n=I(),{summary:o,loading:h,error:f}=Se({enabled:!0}),i=()=>{n(s?"/system?tab=health":"/system?tab=services")},x=o.total>0?o.running/o.total*100:0,m=o.error>0,p=o.stopped>0,l=m?"from-rose-500 to-red-500":p?"from-amber-500 to-yellow-500":"from-emerald-500 to-teal-500",d=m?"rgba(244,63,94,0.35)":p?"rgba(245,158,11,0.35)":"rgba(16,185,129,0.35)",g=m?"hover:shadow-[0_14px_44px_rgba(244,63,94,0.15)]":p?"hover:shadow-[0_14px_44px_rgba(245,158,11,0.15)]":"hover:shadow-[0_14px_44px_rgba(16,185,129,0.15)]",j=()=>m?a("dashboard:services.errorsCount",{count:o.error}):p?a("dashboard:services.stoppedCount",{count:o.stopped}):a("dashboard:services.allHealthy"),w=m?"text-rose-400":p?"text-amber-400":"text-emerald-400";return h?e.jsx("div",{className:`card border-slate-800/40 bg-slate-900/60 ${t}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:a("dashboard:services.title")}),e.jsx("p",{className:"mt-2 text-2xl sm:text-3xl font-semibold text-slate-400",children:a("dashboard:services.loading")})]}),e.jsx("div",{className:"flex h-11 w-11 sm:h-12 sm:w-12 shrink-0 items-center justify-center rounded-2xl bg-slate-800 text-slate-500",children:e.jsx(q,{className:"h-6 w-6"})})]})}):f?e.jsxs("div",{className:`card border-rose-500/30 bg-rose-500/10 ${t}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:a("dashboard:services.title")}),e.jsx("p",{className:"mt-2 text-2xl sm:text-3xl font-semibold text-rose-300",children:a("dashboard:services.error")})]}),e.jsx("div",{className:"flex h-11 w-11 sm:h-12 sm:w-12 shrink-0 items-center justify-center rounded-2xl bg-rose-500/20 text-rose-400",children:e.jsx(q,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"mt-3 sm:mt-4 text-xs text-rose-300",children:a("dashboard:services.failedToLoadStatus")})]}):o.total===0?null:e.jsxs("div",{className:`card border-slate-800/40 bg-slate-900/60 transition-all duration-200 hover:border-slate-700/60 hover:bg-slate-900/80 ${g} active:scale-[0.98] cursor-pointer touch-manipulation ${t}`,onClick:i,children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:a("dashboard:services.title")}),e.jsx("p",{className:"mt-2 text-2xl sm:text-3xl font-semibold text-white truncate",children:a("dashboard:services.running",{count:o.running})})]}),e.jsx("div",{className:`flex h-11 w-11 sm:h-12 sm:w-12 shrink-0 items-center justify-center rounded-2xl bg-gradient-to-br ${l} text-white`,style:{boxShadow:`0 12px 38px ${d}`},children:e.jsx(q,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"mt-3 sm:mt-4 flex flex-col gap-1",children:e.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs text-slate-400",children:[e.jsx("span",{className:"truncate flex-1 min-w-0",children:a("dashboard:services.ofTotal",{total:o.total})}),e.jsx("span",{className:`shrink-0 ${w}`,children:j()})]})}),e.jsx("div",{className:"mt-4 sm:mt-5 h-2 w-full overflow-hidden rounded-full bg-slate-800",children:e.jsx("div",{className:`h-full rounded-full bg-gradient-to-r ${l} transition-all duration-500`,style:{width:`${Math.min(Math.max(x,0),100)}%`}})})]})};function Bt(s={}){const{refreshInterval:t=6e4,enabled:a=!0}=s,[n,o]=c.useState([]),[h,f]=c.useState(!0),[i,x]=c.useState(null),m=c.useCallback(async()=>{try{const l=await Re();o(l.plugins),x(null)}catch(l){const d=l!=null&&typeof l=="object"&&"response"in l?l.response:void 0;if(d?.status===403){o([]),x(null);return}const g=d?.data?.detail||(l instanceof Error?l.message:"Failed to load plugins");x(g)}},[]);return c.useEffect(()=>{a&&(f(!0),m().finally(()=>f(!1)))},[a,m]),c.useEffect(()=>{if(!a||t<=0)return;const l=setInterval(m,t);return()=>clearInterval(l)},[a,t,m]),{summary:c.useMemo(()=>({total:n.length,enabled:n.filter(l=>l.is_enabled).length,disabled:n.filter(l=>!l.is_enabled).length,withErrors:n.filter(l=>l.error).length}),[n]),plugins:n,loading:h,error:i,refetch:m}}const Vt=({isAdmin:s,className:t=""})=>{const{t:a}=R(["dashboard","common"]),n=I(),{summary:o,loading:h,error:f}=Bt({enabled:!0}),i=()=>{s&&n("/plugins")},x=o.total>0?o.enabled/o.total*100:0,m=o.withErrors>0,p=o.total>0&&o.enabled===0,l=o.disabled>0&&o.enabled>0,d=m?"from-rose-500 to-red-500":p?"from-slate-500 to-slate-600":l?"from-amber-500 to-yellow-500":"from-violet-500 to-purple-500",g=m?"rgba(244,63,94,0.35)":p?"rgba(100,116,139,0.35)":l?"rgba(245,158,11,0.35)":"rgba(139,92,246,0.35)",j=m?"hover:shadow-[0_14px_44px_rgba(244,63,94,0.15)]":p?"hover:shadow-[0_14px_44px_rgba(100,116,139,0.15)]":l?"hover:shadow-[0_14px_44px_rgba(245,158,11,0.15)]":"hover:shadow-[0_14px_44px_rgba(139,92,246,0.15)]",w=()=>m?a("dashboard:plugins.errorsCount",{count:o.withErrors}):p?a("dashboard:plugins.noneActive"):l?a("dashboard:plugins.inactive",{count:o.disabled}):a("dashboard:plugins.allActive"),_=m?"text-rose-400":p?"text-slate-400":l?"text-amber-400":"text-emerald-400";return h?e.jsx("div",{className:`card border-slate-800/40 bg-slate-900/60 ${t}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:a("dashboard:plugins.title")}),e.jsx("p",{className:"mt-2 text-2xl sm:text-3xl font-semibold text-slate-400",children:a("dashboard:plugins.loading")})]}),e.jsx("div",{className:"flex h-11 w-11 sm:h-12 sm:w-12 shrink-0 items-center justify-center rounded-2xl bg-slate-800 text-slate-500",children:e.jsx(G,{className:"h-6 w-6"})})]})}):f?e.jsxs("div",{className:`card border-rose-500/30 bg-rose-500/10 ${t}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:a("dashboard:plugins.title")}),e.jsx("p",{className:"mt-2 text-2xl sm:text-3xl font-semibold text-rose-300",children:a("dashboard:plugins.error")})]}),e.jsx("div",{className:"flex h-11 w-11 sm:h-12 sm:w-12 shrink-0 items-center justify-center rounded-2xl bg-rose-500/20 text-rose-400",children:e.jsx(G,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"mt-3 sm:mt-4 text-xs text-rose-300",children:a("dashboard:plugins.failedToLoad")})]}):o.total===0?e.jsxs("div",{className:`card border-slate-800/40 bg-slate-900/60 transition-all duration-200 ${s?"hover:border-slate-700/60 hover:bg-slate-900/80 hover:shadow-[0_14px_44px_rgba(139,92,246,0.15)] active:scale-[0.98] cursor-pointer":"cursor-default"} touch-manipulation ${t}`,onClick:s?i:void 0,children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:a("dashboard:plugins.title")}),e.jsx("p",{className:"mt-2 text-2xl sm:text-3xl font-semibold text-slate-400",children:a("dashboard:plugins.noPlugins")})]}),e.jsx("div",{className:"flex h-11 w-11 sm:h-12 sm:w-12 shrink-0 items-center justify-center rounded-2xl bg-slate-800 text-slate-500",children:e.jsx(G,{className:"h-6 w-6"})})]}),s&&e.jsx("div",{className:"mt-3 sm:mt-4 text-xs text-slate-500",children:a("dashboard:plugins.browseAvailable")})]}):e.jsxs("div",{className:`card border-slate-800/40 bg-slate-900/60 transition-all duration-200 ${s?`hover:border-slate-700/60 hover:bg-slate-900/80 ${j} active:scale-[0.98] cursor-pointer`:"cursor-default"} touch-manipulation ${t}`,onClick:s?i:void 0,children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:a("dashboard:plugins.title")}),e.jsx("p",{className:"mt-2 text-2xl sm:text-3xl font-semibold text-white truncate",children:a("dashboard:plugins.active",{count:o.enabled})})]}),e.jsx("div",{className:`flex h-11 w-11 sm:h-12 sm:w-12 shrink-0 items-center justify-center rounded-2xl bg-gradient-to-br ${d} text-white`,style:{boxShadow:`0 12px 38px ${g}`},children:e.jsx(G,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"mt-3 sm:mt-4 flex flex-col gap-1",children:e.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs text-slate-400",children:[e.jsx("span",{className:"truncate flex-1 min-w-0",children:a("dashboard:plugins.ofInstalled",{total:o.total,count:o.total})}),e.jsx("span",{className:`shrink-0 ${_}`,children:w()})]})}),e.jsx("div",{className:"mt-4 sm:mt-5 h-2 w-full overflow-hidden rounded-full bg-slate-800",children:e.jsx("div",{className:`h-full rounded-full bg-gradient-to-r ${d} transition-all duration-500`,style:{width:`${Math.min(Math.max(x,0),100)}%`}})})]})};function Kt(s={}){const{refreshInterval:t=3e3,enabled:a=!0}=s,[n,o]=c.useState(null),[h,f]=c.useState(!0),[i,x]=c.useState(null),m=c.useCallback(async()=>{try{const l=await He();o(l),x(null)}catch(l){const d=l!=null&&typeof l=="object"&&"response"in l?l.response?.data?.detail:void 0;x(d||(l instanceof Error?l.message:"Failed to load network status"))}},[]);return c.useEffect(()=>{a&&(f(!0),m().finally(()=>f(!1)))},[a,m]),c.useEffect(()=>{if(!a||t<=0)return;const l=setInterval(m,t);return()=>clearInterval(l)},[a,t,m]),{status:c.useMemo(()=>n?{downloadMbps:n.download_mbps,uploadMbps:n.upload_mbps,timestamp:new Date(n.timestamp),interfaceType:n.interface_type||"unknown"}:null,[n]),loading:h,error:i,refetch:m}}function he(s){return s<.01?"0 Mbps":s<1?`${D(s*1e3,0)} Kbps`:s<100?`${D(s,1)} Mbps`:s<1e3?`${D(s,0)} Mbps`:`${D(s/1e3,2)} Gbps`}const qt=({className:s=""})=>{const{t}=R(["dashboard","common"]),a=I(),{status:n,loading:o,error:h}=Kt({refreshInterval:3e3}),f=()=>a("/system?tab=network");if(o)return e.jsx("div",{className:`card border-slate-800/40 bg-slate-900/60 ${s}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:t("dashboard:network.title")}),e.jsx("p",{className:"mt-2 text-2xl sm:text-3xl font-semibold text-slate-400",children:t("dashboard:network.loading")})]}),e.jsx("div",{className:"flex h-11 w-11 sm:h-12 sm:w-12 shrink-0 items-center justify-center rounded-2xl bg-gradient-to-br from-green-500 to-emerald-500 text-white shadow-[0_12px_38px_rgba(16,185,129,0.35)]",children:e.jsx(se,{className:"h-6 w-6"})})]})});if(h||!n)return e.jsxs("div",{className:`card border-slate-800/40 bg-slate-900/60 ${s}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:t("dashboard:network.title")}),e.jsx("p",{className:"mt-2 text-2xl sm:text-3xl font-semibold text-slate-400",children:t("dashboard:network.offline")})]}),e.jsx("div",{className:"flex h-11 w-11 sm:h-12 sm:w-12 shrink-0 items-center justify-center rounded-2xl bg-slate-800 text-slate-500",children:e.jsx(be,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"mt-3 sm:mt-4 flex items-center justify-between gap-2 text-xs text-slate-400",children:e.jsx("span",{className:"truncate",children:t("dashboard:network.monitoringUnavailable")})})]});const{downloadMbps:i,uploadMbps:x,interfaceType:m}=n,p=i+x,d=Math.min(p/1e3*100,100),g=p<.1,j=p>1,w=m==="ethernet"?tt:se;return e.jsxs("div",{onClick:f,className:`card border-slate-800/40 bg-slate-900/60 transition-all duration-200 hover:border-slate-700/60 hover:bg-slate-900/80 hover:shadow-[0_14px_44px_rgba(16,185,129,0.15)] active:scale-[0.98] touch-manipulation cursor-pointer ${s}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:t("dashboard:network.title")}),e.jsxs("div",{className:"mt-2 flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Qe,{className:`h-4 w-4 ${j?"text-emerald-400":"text-slate-500"}`}),e.jsx("span",{className:"text-lg sm:text-xl font-semibold text-white",children:he(i)})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(et,{className:`h-4 w-4 ${j?"text-sky-400":"text-slate-500"}`}),e.jsx("span",{className:"text-lg sm:text-xl font-semibold text-white",children:he(x)})]})]})]}),e.jsx("div",{className:`flex h-11 w-11 sm:h-12 sm:w-12 shrink-0 items-center justify-center rounded-2xl text-white shadow-[0_12px_38px_rgba(16,185,129,0.35)] ${g?"bg-slate-700":"bg-gradient-to-br from-green-500 to-emerald-500"}`,children:e.jsx(w,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"mt-3 sm:mt-4 flex flex-col gap-1",children:e.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs text-slate-400",children:[e.jsx("span",{className:"truncate flex-1 min-w-0",children:t(g?"dashboard:network.idle":j?"dashboard:network.active":"dashboard:network.lowActivity")}),e.jsx("span",{className:`shrink-0 ${j?"text-emerald-400":"text-slate-500"}`,children:t(g?"dashboard:network.standby":"dashboard:network.live")})]})}),e.jsx("div",{className:"mt-4 sm:mt-5 h-2 w-full overflow-hidden rounded-full bg-slate-800",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${g?"bg-slate-600":"bg-gradient-to-r from-green-500 to-emerald-500"}`,style:{width:`${Math.max(d,g?0:2)}%`}})})]})};async function Jt(){const{data:s}=await A.get("/api/devices/all");return s}const Yt=({className:s=""})=>{const{t}=R(["dashboard","common"]),a=I(),[n,o]=c.useState([]),[h,f]=c.useState(!0),[i,x]=c.useState(null),m=c.useCallback(async()=>{try{const d=await Jt();o(d),x(null)}catch(d){const g=d instanceof Error?d.message:"";if(g.includes("403")||g.includes("Forbidden")){o([]),x(null);return}x(g||"Failed to load devices")}},[]);c.useEffect(()=>{f(!0),m().finally(()=>f(!1));const d=setInterval(m,6e4);return()=>clearInterval(d)},[m]);const p=()=>{a("/sync-prototype")},l=Fe.useMemo(()=>{const d=new Date,g=300*1e3,j=n.filter(w=>{if(!w.last_seen)return!1;const _=new Date(w.last_seen);return d.getTime()-_.getTime()<g});return{mobile:n.filter(w=>w.type==="mobile").length,desktop:n.filter(w=>w.type==="desktop").length,total:n.length,activeRecently:j.length}},[n]);return h?e.jsxs("div",{className:`rounded-xl border border-slate-800/50 bg-slate-900/55 p-4 ${s}`,children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:t("dashboard:devices.title")}),e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.jsx("div",{className:"h-6 w-16 rounded bg-slate-800 animate-pulse"}),e.jsx("div",{className:"h-6 w-16 rounded bg-slate-800 animate-pulse"})]})]}):i?e.jsxs("div",{className:`rounded-xl border border-slate-800/50 bg-slate-900/55 p-4 ${s}`,children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:t("dashboard:devices.title")}),e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-sm text-slate-500",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx("span",{children:t("dashboard:devices.unableToLoad")})]})]}):l.total===0?e.jsxs("div",{className:`rounded-xl border border-slate-800/50 bg-slate-900/55 p-4 cursor-pointer transition hover:border-slate-700/60 hover:bg-slate-900/70 ${s}`,onClick:p,children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:t("dashboard:devices.title")}),e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-sm text-slate-500",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx("span",{children:t("dashboard:devices.noDevicesRegistered")})]}),e.jsx("p",{className:"mt-2 text-xs text-slate-600",children:t("dashboard:devices.clickToAddDevice")})]}):e.jsxs("div",{className:`rounded-xl border border-slate-800/50 bg-slate-900/55 p-4 cursor-pointer transition hover:border-slate-700/60 hover:bg-slate-900/70 ${s}`,onClick:p,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:t("dashboard:devices.title")}),l.activeRecently>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"inline-flex h-2 w-2 rounded-full bg-emerald-400 animate-pulse"}),e.jsx("span",{className:"text-xs text-emerald-400",children:t("dashboard:devices.online",{count:l.activeRecently})})]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-violet-500/20",children:e.jsx(st,{className:"h-4 w-4 text-violet-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold text-white",children:l.mobile}),e.jsx("p",{className:"text-xs text-slate-500",children:t("dashboard:devices.mobile")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-sky-500/20",children:e.jsx(at,{className:"h-4 w-4 text-sky-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold text-white",children:l.desktop}),e.jsx("p",{className:"text-xs text-slate-500",children:t("dashboard:devices.desktop")})]})]})]}),e.jsx("p",{className:"mt-3 text-xs text-slate-600",children:t("dashboard:devices.clickToManage")})]})},Gt=({alerts:s,onDismiss:t})=>{const{t:a}=R(["dashboard","common"]),n=I(),[o,h]=c.useState(!1),[f,i]=c.useState(new Set),x=c.useMemo(()=>s.filter(u=>!f.has(u.id)),[s,f]),m=u=>{i(N=>new Set([...N,u])),t?.(u)},p=u=>{n(u)};if(x.length===0)return null;const l=x.filter(u=>u.type==="critical").length,d=x.filter(u=>u.type==="warning").length,g=u=>{switch(u){case"smart":return e.jsx(je,{className:"h-4 w-4"});case"raid":return e.jsx(q,{className:"h-4 w-4"});case"scheduler":return e.jsx(ae,{className:"h-4 w-4"});case"service":return e.jsx(q,{className:"h-4 w-4"});default:return e.jsx(ee,{className:"h-4 w-4"})}},j=u=>{switch(u){case"critical":return{bg:"bg-rose-500/20",border:"border-rose-500/40",text:"text-rose-200",icon:e.jsx(ge,{className:"h-4 w-4 text-rose-400"})};case"warning":return{bg:"bg-amber-500/20",border:"border-amber-500/40",text:"text-amber-200",icon:e.jsx(fe,{className:"h-4 w-4 text-amber-400"})};default:return{bg:"bg-sky-500/20",border:"border-sky-500/40",text:"text-sky-200",icon:e.jsx(ee,{className:"h-4 w-4 text-sky-400"})}}},w=x[0],_=j(w.type);return e.jsxs("div",{className:`rounded-xl border ${_.border} ${_.bg} overflow-hidden`,children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 cursor-pointer",onClick:()=>h(!o),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[_.icon,e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium ${_.text}`,children:x.length===1?w.title:a("dashboard:alerts.systemAlerts",{count:x.length})}),x.length===1&&e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:w.message}),x.length>1&&e.jsxs("p",{className:"text-xs text-slate-400 mt-0.5",children:[l>0&&a("dashboard:alerts.critical",{count:l}),l>0&&d>0&&", ",d>0&&a("dashboard:alerts.warnings",{count:d})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[x.length===1&&w.link&&e.jsx("button",{onClick:u=>{u.stopPropagation(),p(w.link)},className:"rounded-full border border-slate-700/70 px-3 py-1 text-xs text-slate-300 transition hover:border-slate-500 hover:text-white",children:w.linkText||a("dashboard:alerts.view")}),x.length>1&&e.jsx("button",{className:"flex items-center gap-1 text-xs text-slate-400 hover:text-white",children:o?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:a("dashboard:alerts.collapse")}),e.jsx(rt,{className:"h-4 w-4"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:a("dashboard:alerts.expand")}),e.jsx(ve,{className:"h-4 w-4"})]})}),x.length===1&&e.jsx("button",{onClick:u=>{u.stopPropagation(),m(w.id)},className:"p-1 text-slate-400 hover:text-white transition",title:a("dashboard:alerts.dismiss"),children:e.jsx(oe,{className:"h-4 w-4"})})]})]}),o&&x.length>1&&e.jsx("div",{className:"border-t border-slate-800/50 px-4 py-2 space-y-2",children:x.map(u=>{const N=j(u.type);return e.jsxs("div",{className:`flex items-center justify-between rounded-lg ${N.bg} px-3 py-2`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[g(u.source),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium ${N.text}`,children:u.title}),e.jsx("p",{className:"text-xs text-slate-400",children:u.message})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[u.link&&e.jsx("button",{onClick:()=>p(u.link),className:"rounded-full border border-slate-700/70 px-2 py-0.5 text-xs text-slate-300 transition hover:border-slate-500 hover:text-white",children:u.linkText||a("dashboard:alerts.view")}),e.jsx("button",{onClick:()=>m(u.id),className:"p-1 text-slate-400 hover:text-white transition",title:a("dashboard:alerts.dismiss"),children:e.jsx(oe,{className:"h-3.5 w-3.5"})})]})]},u.id)})})]})},Xt={clock:ae,wind:lt,"hard-drive":je,zap:K};function Zt({activities:s}){const[t,a]=c.useState(!1),n=I(),{t:o}=R("dashboard");if(s.length===0)return null;const f=s.some(i=>i.level==="warning")?"bg-amber-400":"bg-sky-400";return e.jsxs("div",{className:"rounded-2xl border border-slate-800/50 bg-slate-900/55 overflow-hidden",children:[e.jsxs("button",{onClick:()=>a(i=>!i),className:"flex w-full items-center gap-3 px-4 py-3 text-left transition-colors hover:bg-slate-800/40",children:[e.jsx("span",{className:`inline-flex h-2 w-2 shrink-0 rounded-full animate-pulse ${f}`}),e.jsx(nt,{className:"h-4 w-4 shrink-0 text-slate-400"}),e.jsx("span",{className:"text-sm font-medium text-slate-200",children:o("liveActivities.title")}),e.jsx("span",{className:"rounded-full border border-slate-700/60 bg-slate-800/60 px-2 py-0.5 text-xs tabular-nums text-slate-400",children:o("liveActivities.count",{count:s.length})}),e.jsx("span",{className:"flex-1"}),e.jsx(ve,{className:`h-4 w-4 shrink-0 text-slate-500 transition-transform duration-200 ${t?"rotate-180":""}`})]}),e.jsx("div",{className:`grid transition-[grid-template-rows] duration-200 ${t?"grid-rows-[1fr]":"grid-rows-[0fr]"}`,children:e.jsx("div",{className:"overflow-hidden",children:e.jsx("div",{className:"divide-y divide-slate-800/40 border-t border-slate-800/40",children:s.map(i=>{const x=Xt[i.icon],m=i.level==="warning",p=m?"bg-amber-400":"bg-sky-400",l=m?"text-amber-400":"text-sky-400",d=m?"bg-gradient-to-r from-amber-500 to-orange-500":"bg-gradient-to-r from-sky-500 to-indigo-500";return e.jsxs("button",{onClick:()=>i.link&&n(i.link),className:"flex w-full items-center gap-3 px-4 py-3 text-left transition-colors hover:bg-slate-800/40",children:[e.jsx("span",{className:`inline-flex h-2 w-2 shrink-0 rounded-full animate-pulse ${p}`}),e.jsx(x,{className:`h-4 w-4 shrink-0 ${l}`}),e.jsx("span",{className:"min-w-0 flex-1 text-sm text-slate-200 truncate",children:o(i.label,i.labelParams)}),i.progress!=null&&e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("div",{className:"h-1.5 w-20 overflow-hidden rounded-full bg-slate-800",children:e.jsx("div",{className:`h-full rounded-full ${d} transition-all duration-500`,style:{width:`${Math.min(Math.max(i.progress,0),100)}%`}})}),e.jsxs("span",{className:"text-xs tabular-nums text-slate-400 w-8 text-right",children:[Math.round(i.progress),"%"]})]}),e.jsx(it,{className:"h-4 w-4 shrink-0 text-slate-600"})]},i.id)})})})})]})}const $e="raid_status_cache",Qt=12e4;function es(){try{const s=sessionStorage.getItem($e);if(s){const t=JSON.parse(s);if(Date.now()-(t.timestamp||0)<Qt)return t.raid}}catch{}return null}function ts(s){try{sessionStorage.setItem($e,JSON.stringify({raid:s,timestamp:Date.now()}))}catch{}}function cs(){const s=I(),{t}=R("dashboard"),{isAdmin:a}=pe(),{system:n,storage:o,loading:h,error:f,lastUpdated:i,history:x}=xt(),m=()=>s("/system?tab=cpu"),p=()=>s("/system?tab=memory"),l=()=>s("/system?tab=disk-io"),{smartData:d,loading:g,error:j,refetch:w}=bt(),_=es(),[u,N]=c.useState(_),[y,T]=c.useState(!_),[E,k]=c.useState(null),[P,W]=c.useState(!1),{allSchedulers:U}=_e({enabled:a}),{services:O}=Se({enabled:a}),{activities:z}=Tt({raidData:u,schedulers:U,isAdmin:a});c.useEffect(()=>{const r=async()=>{try{const v=await vt();N(v),ts(v)}catch{}finally{T(!1)}};r();const b=setInterval(r,6e4);return()=>clearInterval(b)},[]),c.useEffect(()=>{(async()=>{try{if(!(await jt())?.dev_mode)return;const{getSmartMode:v}=await ie(async()=>{const{getSmartMode:C}=await Promise.resolve().then(()=>de);return{getSmartMode:C}},void 0),S=await v();k(S.mode)}catch{}})()},[]);const Me=async()=>{W(!0);try{const{toggleSmartMode:r}=await ie(async()=>{const{toggleSmartMode:v}=await Promise.resolve().then(()=>de);return{toggleSmartMode:v}},void 0),b=await r();k(b.mode),w()}catch{}finally{W(!1)}},M=c.useMemo(()=>{const r=Math.max(0,Math.min(n?.cpu.usage??0,100)),b=n?.cpu.cores??0,v=n?.memory.used??0,S=n?.memory.total??0,C=n?.uptime??0;return{cpuUsage:r,cpuCores:b,memoryUsed:v,memoryTotal:S,uptime:C}},[n]),F=c.useMemo(()=>{let r=0,b=0;o&&o.total>0?(r=o.total,b=o.used):d&&d.devices.length>0&&(r=d.devices.reduce((C,B)=>C+(B.capacity_bytes||0),0),b=d.devices.reduce((C,B)=>C+(B.used_bytes||0),0));const v=Math.max(r-b,0),S=r?b/r*100:0;return{used:b,total:r,available:v,percent:Math.min(Math.max(S,0),100)}},[o,d]),Ce=c.useMemo(()=>M.memoryTotal?M.memoryUsed/M.memoryTotal*100:0,[M.memoryTotal,M.memoryUsed]),De=c.useMemo(()=>{const r=x.cpu;if(r.length<2)return null;const b=r[r.length-1]?.usage??0,v=r[r.length-2]?.usage??b;return b-v},[x.cpu]),Te=c.useMemo(()=>{const r=x.memory;if(r.length<2)return null;const b=r[r.length-1]?.percent??0,v=r[r.length-2]?.percent??b;return b-v},[x.memory]),Ee=null,X=(r,b="%")=>{if(r===null)return{label:"Live",tone:"live"};const v=Number(r.toFixed(1));return v===0?{label:`0${b}`,tone:"steady"}:v>0?{label:`+${v}${b}`,tone:"increase"}:{label:`${v}${b}`,tone:"decrease"}},J=c.useMemo(()=>n?.cpu?.frequency_mhz?`${D(n.cpu.frequency_mhz/1e3,2)} GHz`:null,[n]),H=c.useMemo(()=>{const r=n?.cpu?.temperature_celsius;return typeof r=="number"?`${D(r,1)}Â°C`:null},[n]),Z=c.useMemo(()=>n?.cpu?.model||null,[n]),re=c.useMemo(()=>{const r=n?.memory?.speed_mts,b=n?.memory?.type;return r&&b?`${b} @ ${r} MT/s`:b||(r?`${r} MT/s`:null)},[n]),ne=c.useMemo(()=>{const r=[];if(d){const b=d.devices.filter(S=>S.status==="FAILED"),v=d.devices.filter(S=>S.status==="UNKNOWN");b.length>0&&r.push({id:"smart-failure",type:"critical",title:t("alerts.smartFailure.title"),message:t("alerts.smartFailure.message",{count:b.length}),link:"/system",linkText:t("alerts.viewDetails"),source:"smart"}),v.length>0&&r.push({id:"smart-unknown",type:"warning",title:t("alerts.smartUnknown.title"),message:t("alerts.smartUnknown.message",{count:v.length}),link:"/system",linkText:t("alerts.viewDetails"),source:"smart"})}if(u&&u.arrays.some(b=>b.status.includes("degraded"))){const b=u.arrays.filter(v=>v.status.includes("degraded"));r.push({id:"raid-degraded",type:"critical",title:t("alerts.raidDegraded.title"),message:t("alerts.raidDegraded.message",{count:b.length}),link:"/raid",linkText:t("alerts.viewRaid"),source:"raid"})}if(a&&U.some(b=>b.last_status==="failed")){const b=U.filter(v=>v.last_status==="failed");r.push({id:"scheduler-failed",type:"warning",title:t("alerts.schedulerFailed.title"),message:t("alerts.schedulerFailed.message",{count:b.length}),link:"/schedulers",linkText:t("alerts.viewSchedulers"),source:"scheduler"})}if(a&&O.some(b=>b.state==="error")){const b=O.filter(v=>v.state==="error");r.push({id:"service-error",type:"warning",title:t("alerts.serviceError.title"),message:t("alerts.serviceError.message",{count:b.length}),link:"/health",linkText:t("alerts.viewHealth"),source:"service"})}return r},[d,u,U,O,a,t]),Ae=[{id:"cpu",title:t("stats.cpu"),value:`${D(M.cpuUsage,1)}%`,meta:Z||(J?t("stats.coresAt",{count:M.cpuCores||0,frequency:J})+(H?` â€¢ ${H}`:""):t("stats.coresActive",{count:M.cpuCores||0})+(H?` â€¢ ${H}`:"")),submeta:Z&&J?t("stats.coresAt",{count:M.cpuCores||0,frequency:J})+(H?` â€¢ ${H}`:""):void 0,delta:X(De),accent:"from-violet-500 to-fuchsia-500",progress:M.cpuUsage,icon:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H6.75A1.5 1.5 0 005.25 6v12a1.5 1.5 0 001.5 1.5z"})})},{id:"memory",title:t("stats.memory"),value:L(M.memoryUsed),meta:re||t("stats.ofTotal",{total:L(M.memoryTotal)}),submeta:re?t("stats.ofTotal",{total:L(M.memoryTotal)}):void 0,delta:X(Te),accent:"from-sky-500 to-indigo-500",progress:Ce,icon:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 5.25h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5M6 3v18m6-18v18m6-18v18"})})},{id:"storage",title:t("stats.totalStorage"),value:L(F.used),meta:F.total?t("stats.ofTotal",{total:L(F.total)}):t("stats.awaitingMount"),delta:X(Ee),accent:"from-cyan-500 to-sky-600",progress:F.percent,icon:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 3.75H6.912a2.25 2.25 0 00-2.15 1.588L2.35 13.177a2.25 2.25 0 00-.1.661V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 00-2.15-1.588H15M2.25 13.5h3.86a2.25 2.25 0 012.012 1.244l.256.512a2.25 2.25 0 002.013 1.244h3.218a2.25 2.25 0 002.013-1.244l.256-.512a2.25 2.25 0 012.013-1.244h3.859M12 3v8.25m0 0l-3-3m3 3l3-3"})})},{id:"uptime",title:t("stats.uptime"),value:Pe(M.uptime),meta:t("stats.systemAvailability"),delta:{label:"Live",tone:"live"},accent:"from-emerald-500 to-teal-500",progress:100,icon:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.636 5.636a9 9 0 1012.728 0M12 3v9"})})}];return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-wrap items-end justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold text-white",children:t("title")}),e.jsx("p",{className:"mt-1 text-sm text-slate-400",children:t("subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-slate-800 bg-slate-900/60 px-4 py-2 text-xs text-slate-400 shadow-inner",children:[e.jsx("span",{className:`inline-flex h-2 w-2 rounded-full ${i?"bg-emerald-400":"bg-amber-400 animate-pulse"}`}),i?t("sync.synced",{time:i.toLocaleTimeString()}):t("sync.waiting")]})]}),ne.length>0&&e.jsx(Gt,{alerts:ne}),f&&e.jsx("div",{className:"card border-rose-500/30 bg-rose-500/10 text-sm text-rose-100",children:f}),h?e.jsx("div",{className:"card",children:e.jsx("p",{className:"text-sm text-slate-500",children:t("loading")})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-5 md:grid-cols-2 xl:grid-cols-4",children:[Ae.map(r=>{const b=r.delta.tone==="decrease"?"text-emerald-400":r.delta.tone==="increase"?"text-rose-300":r.delta.tone==="steady"?"text-slate-400":"text-sky-400",v=r.id==="cpu"?m:r.id==="memory"?p:r.id==="storage"?l:void 0,S=!!v;return e.jsxs("div",{onClick:v,className:`card border-slate-800/40 bg-slate-900/60 transition-all duration-200 hover:border-slate-700/60 hover:bg-slate-900/80 hover:shadow-[0_14px_44px_rgba(56,189,248,0.15)] active:scale-[0.98] touch-manipulation ${S?"cursor-pointer":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:r.title}),e.jsx("p",{className:"mt-2 text-2xl sm:text-3xl font-semibold text-white truncate",children:r.value})]}),e.jsx("div",{className:`flex h-11 w-11 sm:h-12 sm:w-12 shrink-0 items-center justify-center rounded-2xl bg-gradient-to-br ${r.accent} text-white shadow-[0_12px_38px_rgba(59,130,246,0.35)]`,children:r.icon})]}),e.jsxs("div",{className:"mt-3 sm:mt-4 flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs text-slate-400",children:[e.jsx("span",{className:"truncate flex-1 min-w-0",children:r.meta}),e.jsx("span",{className:`${b} shrink-0`,children:r.delta.label})]}),r.submeta&&e.jsx("div",{className:"text-xs text-slate-500 truncate",children:r.submeta})]}),e.jsx("div",{className:"mt-4 sm:mt-5 h-2 w-full overflow-hidden rounded-full bg-slate-800",children:e.jsx("div",{className:`h-full rounded-full bg-gradient-to-r ${r.accent} transition-all duration-500`,style:{width:`${Math.min(Math.max(r.progress,0),100)}%`}})})]},r.id)}),e.jsx(Lt,{}),e.jsx(qt,{}),e.jsx(zt,{isAdmin:a}),e.jsx(Vt,{isAdmin:a})]}),z.length>0&&e.jsx(Zt,{activities:z}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsxs("div",{className:"card border-slate-800/50 bg-slate-900/55",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.32em] text-slate-500",children:t("smart.title")}),e.jsx("h2",{className:"mt-2 text-xl font-semibold text-white",children:t("smart.subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[E&&e.jsx("button",{onClick:Me,disabled:P,className:"rounded-full border border-slate-700/70 bg-slate-800/50 px-3 py-1 text-slate-300 transition hover:border-sky-500/50 hover:bg-slate-700/50 hover:text-white disabled:opacity-50",title:t("smart.modeToggle.current",{mode:t(E==="mock"?"smart.modeToggle.mock":"smart.modeToggle.real")}),children:P?"...":E==="mock"?"ðŸ”„ Mock":"ðŸ”„ Real"}),g?e.jsx("span",{className:"rounded-full border border-slate-700 px-3 py-1 text-slate-400",children:t("network.loading")}):j?e.jsx("span",{className:"rounded-full border border-rose-500/30 bg-rose-500/10 px-3 py-1 text-rose-200",children:t("smart.error")}):e.jsx("span",{className:"rounded-full border border-emerald-500/30 bg-emerald-500/10 px-3 py-1 text-emerald-200",children:t("smart.healthy")})]})]}),e.jsx("div",{className:"mt-6",children:g?e.jsx("div",{className:"flex h-52 items-center justify-center rounded-2xl border border-slate-800/60 bg-slate-900/60 text-sm text-slate-500",children:t("smart.loading")}):j?e.jsx("div",{className:"flex h-52 items-center justify-center rounded-2xl border border-rose-500/30 bg-rose-500/10 text-sm text-rose-200",children:j}):d&&d.devices.length>0?e.jsx("div",{className:"space-y-3",children:d.devices.map(r=>{const b=r.attributes.filter($=>["Reallocated_Sector_Ct","Current_Pending_Sector","Uncorrectable_Error_Cnt"].includes($.name)),v=r.attributes.find($=>$.name==="Temperature_Celsius");let S=r.used_percent??0,C=r.used_bytes??0;if(C===0&&F.used>0){const $=r.capacity_bytes||0;if(r.raid_member_of&&$>0)C=F.used,S=C/$*100;else if($>0){const le=d.devices.filter(V=>!V.raid_member_of).reduce((V,Le)=>V+(Le.capacity_bytes||0),0);if(le>0){const V=$/le;C=Math.round(F.used*V),S=C/$*100}}}const B={backgroundImage:`conic-gradient(#0ea5e9 ${Math.min(S,100)*3.6}deg, rgba(15,23,42,0.8) ${Math.min(S,100)*3.6}deg)`};return e.jsx("div",{className:"rounded-2xl border border-slate-800 bg-slate-900/70 p-4 transition hover:border-sky-500/30",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-slate-950/70",children:e.jsx("svg",{className:"h-5 w-5 text-sky-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 3.75H6.912a2.25 2.25 0 00-2.15 1.588L2.35 13.177a2.25 2.25 0 00-.1.661V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 00-2.15-1.588H15"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-100",children:r.model}),e.jsxs("p",{className:"text-xs text-slate-500",children:[r.name," â€¢ ",r.serial]})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:t("smart.device.status")}),e.jsx("p",{className:`mt-1 font-medium ${r.status==="PASSED"?"text-emerald-300":r.status==="UNKNOWN"?"text-amber-300":"text-rose-300"}`,children:r.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:t("smart.device.capacity")}),e.jsx("p",{className:"mt-1 font-medium text-slate-200",children:r.capacity_bytes?L(r.capacity_bytes):"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:t("smart.device.temperature")}),e.jsx("p",{className:"mt-1 font-medium text-slate-200",children:r.temperature!==null?`${r.temperature}Â°C`:v?`${v.raw}Â°C`:"N/A"})]}),b.slice(0,1).map($=>e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:$.name.replace(/_/g," ")}),e.jsxs("p",{className:`mt-1 font-medium ${$.status==="OK"?"text-emerald-300":"text-rose-300"}`,children:[$.raw," (",$.status,")"]})]},$.id))]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center flex-shrink-0",children:[e.jsxs("div",{className:"relative flex h-16 w-16 sm:h-20 sm:w-20 items-center justify-center",children:[e.jsxs("div",{className:"glow-ring h-16 w-16 sm:h-20 sm:w-20",children:[e.jsx("div",{className:"absolute inset-1 rounded-full border border-slate-900/80 bg-slate-950/80"}),e.jsx("div",{className:"glow-ring h-12 w-12 sm:h-16 sm:w-16 border-none",style:B,children:e.jsx("div",{className:"h-8 w-8 sm:h-12 sm:w-12 rounded-full bg-slate-950/90"})})]}),e.jsxs("div",{className:"absolute text-center",children:[e.jsxs("p",{className:"text-sm sm:text-base font-semibold text-white",children:[Math.round(S),"%"]}),e.jsx("p",{className:"text-[0.5rem] sm:text-[0.55rem] text-slate-400",children:L(C)})]})]}),e.jsx("p",{className:"mt-1 text-[0.65rem] text-slate-500",children:t("smart.device.used")})]})]})},r.serial)})}):e.jsx("div",{className:"flex h-52 items-center justify-center rounded-2xl border border-slate-800/60 bg-slate-900/60 text-sm text-slate-500",children:t("smart.noDevices")})})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 xl:grid-cols-[2fr_1fr]",children:[e.jsx(Ot,{limit:5}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card border-slate-800/50 bg-slate-900/55",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:t("raid.configTitle")}),e.jsx("h3",{className:"mt-2 text-lg font-semibold text-white",children:t("raid.title")}),y?e.jsx("div",{className:"mt-5 text-sm text-slate-500",children:t("raid.loading")}):u&&u.arrays.length>0?e.jsx("div",{className:"mt-5 space-y-3",children:u.arrays.map(r=>e.jsxs("div",{className:"rounded-xl border border-slate-800 bg-slate-900/70 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-100",children:r.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:["RAID ",r.level," â€¢ ",L(r.size_bytes)]})]}),e.jsx("span",{className:`rounded-full border px-2 py-0.5 text-xs ${r.status==="clean"||r.status==="optimal"?"border-emerald-500/30 bg-emerald-500/10 text-emerald-300":r.status==="checking"?"border-indigo-500/30 bg-indigo-500/10 text-indigo-300":r.status==="rebuilding"?"border-sky-500/30 bg-sky-500/10 text-sky-300":r.status.includes("degraded")?"border-amber-500/30 bg-amber-500/10 text-amber-300":"border-rose-500/30 bg-rose-500/10 text-rose-300"}`,children:r.status})]}),e.jsxs("div",{className:"mt-2 text-xs text-slate-400",children:[t("raid.devices",{count:r.devices.length})," â€¢ ",t("raid.active",{count:r.devices.filter(b=>b.state.includes("active")).length})]}),r.resync_progress!==null&&r.resync_progress!==void 0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-400 mb-1",children:[e.jsx("span",{children:t("raid.resyncProgress")}),e.jsxs("span",{children:[D(r.resync_progress,1),"%"]})]}),e.jsx("div",{className:"h-1.5 w-full overflow-hidden rounded-full bg-slate-800",children:e.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-sky-500 to-indigo-500",style:{width:`${r.resync_progress}%`}})})]})]},r.name))}):e.jsx("div",{className:"mt-5 text-sm text-slate-500",children:t("raid.noArrays")})]}),e.jsxs("div",{className:"card border-slate-800/50 bg-slate-900/55",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-slate-500",children:t("health.title")}),e.jsx("h3",{className:"mt-2 text-lg font-semibold text-white",children:t("health.checksTitle")}),e.jsxs("ul",{className:"mt-5 space-y-3 text-sm text-slate-400",children:[e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{children:t("smart.subtitle")}),g?e.jsx("span",{className:"text-slate-400",children:t("health.checking")}):j?e.jsx("span",{className:"text-rose-300",children:t("health.error")}):d&&d.devices.every(r=>r.status==="PASSED")?e.jsx("span",{className:"text-emerald-300",children:t("health.allDrivesOk")}):e.jsx("span",{className:"text-amber-300",children:t("health.warningDetected")})]}),e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{children:t("system.raidStatus")}),y?e.jsx("span",{className:"text-slate-400",children:t("health.checking")}):u&&u.arrays.every(r=>["clean","optimal","checking"].includes(r.status))?e.jsx("span",{className:"text-emerald-300",children:t("health.arraysOptimal")}):u&&u.arrays.some(r=>r.status.includes("degraded"))?e.jsx("span",{className:"text-amber-300",children:t("health.degraded")}):e.jsx("span",{className:"text-slate-400",children:t("health.noRaid")})]}),e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{children:t("health.physicalDrives")}),e.jsx("span",{className:"text-slate-200",children:d?t("health.detected",{count:d.devices.length}):"â€”"})]}),e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{children:t("health.totalCapacity")}),e.jsx("span",{className:"text-slate-200",children:d&&d.devices.length>0?L(d.devices.reduce((r,b)=>r+(b.capacity_bytes||0),0)):"â€”"})]}),e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{children:t("health.avgTemp")}),e.jsx("span",{className:"text-slate-200",children:d&&d.devices.length>0?`${Math.round(d.devices.reduce((r,b)=>r+(b.temperature||0),0)/d.devices.length)}Â°C`:"â€”"})]}),e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{children:t("health.storageUsed")}),e.jsxs("span",{className:"text-slate-200",children:[D(F.percent,1),"%"]})]})]})]}),e.jsx(Yt,{}),e.jsx(Ht,{showAllSchedulers:a})]})]})]})]})}export{cs as default};
