import{d,j as e,g as _,i as W}from"./index-di5tIgDA.js";import{a as i}from"./vendor-react-ZzjCT2KX.js";import{R as C,p as R,G as F,Z as D,H as E,a2 as L,a3 as M,W as S,v as T,x as B,y as U,c as H,a4 as I,q as O}from"./vendor-icons-eCvzHHv5.js";import"./vendor-i18n-DuW_MkEn.js";import"./vendor-charts-Dce8K_o7.js";const k={online:{label:"Online",color:"text-emerald-400",bg:"bg-emerald-500",pulse:!1},booting:{label:"Booting",color:"text-amber-400",bg:"bg-amber-500",pulse:!0},shutting_down:{label:"Shutting Down",color:"text-amber-400",bg:"bg-amber-500",pulse:!0},offline:{label:"Offline",color:"text-slate-500",bg:"bg-slate-600",pulse:!1},unknown:{label:"Unknown",color:"text-slate-500",bg:"bg-slate-600",pulse:!1}};function f(a){if(!a)return"--";const x=Date.now()-new Date(a).getTime(),l=Math.floor(x/6e4);if(l<1)return"just now";if(l<60)return`${l}m ago`;const r=Math.floor(l/60);return r<24?`${r}h ago`:`${Math.floor(r/24)}d ago`}function Q(){const[a,x]=i.useState(null),[l,r]=i.useState(null),[n,A]=i.useState(null),[t,$]=i.useState(null),[b,g]=i.useState(!1),[j,m]=i.useState(null),[N,v]=i.useState(!1),o=i.useCallback(async()=>{v(!0);try{const[s,c,w,y]=await Promise.allSettled([d.get("/api/handshake/status"),d.get("/api/energy/current"),d.get("/api/system/status"),d.get("/api/snapshot")]);s.status==="fulfilled"&&x(s.value.data),c.status==="fulfilled"&&r(c.value.data),w.status==="fulfilled"&&A(w.value.data),y.status==="fulfilled"&&$(y.value.data)}finally{v(!1)}},[]);i.useEffect(()=>{o();const s=setInterval(o,3e4);return()=>clearInterval(s)},[o]);const P=async()=>{g(!0),m(null);try{await d.post("/api/nas/wol"),m("WoL packet sent")}catch{m("Failed to send WoL")}finally{g(!1),setTimeout(()=>m(null),5e3)}},h=k[a?.nas_state??"unknown"]??k.unknown,p=t?.storage.total_bytes?Math.round(t.storage.used_bytes/t.storage.total_bytes*100):0;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-lg bg-gradient-to-br from-sky-500 to-indigo-600 text-sm font-bold text-white",children:"BP"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-white",children:"BaluPi"}),e.jsxs("p",{className:"text-xs text-slate-500",children:[n?.hostname??"Pi"," Status Panel"]})]})]}),e.jsxs("button",{onClick:o,disabled:N,className:"flex items-center gap-1.5 rounded-md border border-slate-700 bg-slate-800 px-2.5 py-1.5 text-xs text-slate-400 transition hover:border-slate-600 hover:text-slate-300 disabled:opacity-50",children:[e.jsx(C,{className:`h-3.5 w-3.5 ${N?"animate-spin":""}`}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-xl border border-slate-800 bg-slate-900/80 p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4 text-slate-400"}),e.jsx("span",{className:"text-xs font-medium uppercase tracking-wider text-slate-400",children:"NAS Status"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`h-2.5 w-2.5 rounded-full ${h.bg} ${h.pulse?"animate-pulse":""}`}),e.jsx("span",{className:`text-sm font-semibold ${h.color}`,children:h.label})]})]}),e.jsxs("div",{className:"space-y-2 text-xs text-slate-400",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"State since"}),e.jsx("span",{className:"text-slate-300",children:f(a?.since??null)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Last snapshot"}),e.jsx("span",{className:"text-slate-300",children:f(a?.last_snapshot??null)})]})]}),a?.nas_state!=="online"&&a?.nas_state!=="booting"&&e.jsxs("div",{className:"mt-3 border-t border-slate-800 pt-3",children:[e.jsxs("button",{onClick:P,disabled:b,className:"flex w-full items-center justify-center gap-2 rounded-lg bg-sky-600 px-3 py-2 text-xs font-medium text-white transition hover:bg-sky-500 disabled:opacity-50",children:[e.jsx(F,{className:"h-3.5 w-3.5"}),b?"Sending...":"Wake NAS"]}),j&&e.jsx("p",{className:`mt-1.5 text-center text-xs ${j.includes("Failed")?"text-rose-400":"text-emerald-400"}`,children:j})]})]}),e.jsxs("div",{className:"rounded-xl border border-slate-800 bg-slate-900/80 p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-amber-400"}),e.jsx("span",{className:"text-xs font-medium uppercase tracking-wider text-slate-400",children:"Energy"})]}),l&&l.devices.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-2xl font-bold tabular-nums text-white",children:l.total_power_w.toFixed(1)}),e.jsx("span",{className:"text-sm text-slate-400",children:"W"})]}),l.devices.map(s=>e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-400",children:[e.jsx("span",{children:s.name||s.device_id}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"tabular-nums text-slate-300",children:[s.power_w.toFixed(1)," W"]}),e.jsxs("span",{className:"tabular-nums",children:[s.voltage_v.toFixed(0)," V"]})]})]},s.device_id)),e.jsxs("div",{className:"border-t border-slate-800 pt-2 text-xs text-slate-500",children:["~",(l.total_power_w*24/1e3*.3).toFixed(2)," EUR/day @0.30/kWh"]})]}):e.jsx("p",{className:"text-xs text-slate-500",children:"No energy data available"})]})]}),t&&e.jsxs("div",{className:"rounded-xl border border-slate-800 bg-slate-900/80 p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4 text-slate-400"}),e.jsx("span",{className:"text-xs font-medium uppercase tracking-wider text-slate-400",children:"NAS Snapshot"})]}),e.jsxs("span",{className:"text-xs text-slate-500",children:["v",t.baluhost_version," · ",f(t.generated_at)]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-xs text-slate-500",children:"Storage"}),e.jsxs("div",{className:"mb-1.5 flex items-baseline gap-1",children:[e.jsxs("span",{className:"text-lg font-bold tabular-nums text-white",children:[p,"%"]}),e.jsx("span",{className:"text-xs text-slate-400",children:"used"})]}),e.jsx("div",{className:"h-1.5 w-full overflow-hidden rounded-full bg-slate-800",children:e.jsx("div",{className:`h-full rounded-full transition-all ${p>90?"bg-rose-500":p>70?"bg-amber-500":"bg-sky-500"}`,style:{width:`${p}%`}})}),e.jsxs("p",{className:"mt-1 text-xs text-slate-500",children:[_(t.storage.used_bytes)," / ",_(t.storage.total_bytes)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-xs text-slate-500",children:"RAID Arrays"}),t.storage.arrays.length>0?e.jsx("div",{className:"space-y-1.5",children:t.storage.arrays.map(s=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:`h-1.5 w-1.5 rounded-full ${s.state==="active"?"bg-emerald-500":"bg-rose-500"}`}),e.jsx("span",{className:"font-mono text-slate-300",children:s.name})]}),e.jsxs("span",{className:"text-slate-500",children:[s.level.toUpperCase()," · ",s.devices.length," disks"]})]},s.name))}):e.jsx("p",{className:"text-xs text-slate-500",children:"No arrays"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-xs text-slate-500",children:"Disk Health"}),Object.keys(t.smart_health).length>0?e.jsx("div",{className:"space-y-1.5",children:Object.entries(t.smart_health).map(([s,c])=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[c.status==="PASSED"?e.jsx(L,{className:"h-3 w-3 text-emerald-500"}):e.jsx(M,{className:"h-3 w-3 text-rose-500"}),e.jsx("span",{className:"font-mono text-slate-300",children:s})]}),c.temperature_c!=null&&e.jsxs("span",{className:"text-slate-500",children:[c.temperature_c,"°C"]})]},s))}):e.jsx("p",{className:"text-xs text-slate-500",children:"No SMART data"})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-4 border-t border-slate-800 pt-3 text-xs text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(S,{className:"h-3 w-3"}),e.jsxs("span",{children:[t.services.vpn.active_clients," VPN clients"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(T,{className:"h-3 w-3"}),e.jsxs("span",{children:[t.services.shares.active_shares," shares"]})]}),e.jsxs("div",{children:[t.users.total," users · ",t.files_summary.total_files.toLocaleString()," files"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-xl border border-slate-800 bg-slate-900/80 p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4 text-slate-400"}),e.jsx("span",{className:"text-xs font-medium uppercase tracking-wider text-slate-400",children:"Pi Health"})]}),n?e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(u,{label:"CPU",value:`${n.cpu_percent.toFixed(0)}%`,warn:n.cpu_percent>80}),e.jsx(u,{label:"RAM",value:`${n.memory_percent.toFixed(0)}%`,warn:n.memory_percent>85}),e.jsx(u,{label:"Temp",value:n.temperature_c!=null?`${n.temperature_c.toFixed(0)}°C`:"--",warn:n.temperature_c!=null&&n.temperature_c>70,icon:e.jsx(U,{className:"h-3 w-3"})}),e.jsx(u,{label:"Uptime",value:W(n.uptime_seconds),icon:e.jsx(H,{className:"h-3 w-3"})})]}):e.jsx("p",{className:"text-xs text-slate-500",children:"Loading..."})]}),e.jsxs("div",{className:"rounded-xl border border-slate-800 bg-slate-900/80 p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-slate-400"}),e.jsx("span",{className:"text-xs font-medium uppercase tracking-wider text-slate-400",children:"SMB Inbox"})]}),a?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-2xl font-bold tabular-nums text-white",children:a.inbox_files??0}),e.jsx("span",{className:"text-sm text-slate-400",children:"files"})]}),e.jsxs("p",{className:"text-xs text-slate-400",children:[(a.inbox_size_mb??0).toFixed(1)," MB waiting"]}),e.jsx("p",{className:"text-xs text-slate-500",children:a.nas_state==="online"?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"h-3 w-3 text-emerald-500"}),"Will flush on next sync"]}):e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"h-3 w-3 text-slate-500"}),"Queued until NAS comes online"]})})]}):e.jsx("p",{className:"text-xs text-slate-500",children:"Loading..."})]})]})]})}function u({label:a,value:x,warn:l,icon:r}){return e.jsxs("div",{children:[e.jsxs("p",{className:"mb-0.5 flex items-center gap-1 text-xs text-slate-500",children:[r,a]}),e.jsx("p",{className:`text-sm font-semibold tabular-nums ${l?"text-amber-400":"text-slate-200"}`,children:x})]})}export{Q as default};
