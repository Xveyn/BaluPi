import{u as O,a as P,j as e,l as $,D as z,b as F}from"./index-DDikNu0A.js";import{a as r}from"./vendor-react-ZzjCT2KX.js";import{u as H}from"./vendor-i18n-DuW_MkEn.js";import"./vendor-icons-eCvzHHv5.js";import"./vendor-charts-Dce8K_o7.js";function K(){const{login:x}=O(),{t}=H("login"),{version:E,loading:C}=P(),[f,T]=r.useState(""),[h,L]=r.useState(""),[d,c]=r.useState(""),[m,l]=r.useState(!1),[M,_]=r.useState(!1),[i,g]=r.useState("checking"),[B,k]=r.useState(!1),[u,y]=r.useState(!1),[q,b]=r.useState(""),[w,v]=r.useState(""),j=r.useRef(null);r.useEffect(()=>{(async()=>{const s=await F.isAvailable();_(s),g(s?"local":"ipc")})()},[]),r.useEffect(()=>{fetch("/api/system/mode").then(a=>a.json()).then(a=>k(a.dev_mode===!0)).catch(()=>k(!1))},[]),r.useEffect(()=>{u&&j.current&&j.current.focus()},[u]);const D=async a=>{a.preventDefault(),c(""),l(!0);try{if(M)try{const p=await F.login(f,h),S=p;if(S.requires_2fa){b(String(S.pending_token??"")),y(!0),l(!1);return}g("local"),x(p.user,p.access_token);return}catch{g("fallback")}const s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:f,password:h})}),o=s.headers.get("content-type");let n={};if(o&&o.includes("application/json"))try{n=await s.json()}catch{throw new Error("Server returned invalid response")}else throw await s.text(),new Error(`Server error: ${s.status}`);if(!s.ok)throw new Error(String(n.detail||n.error||`Login failed (${s.status})`));if(n.requires_2fa){b(String(n.pending_token??"")),y(!0),l(!1);return}const N=n.access_token??n.token;if(typeof N!="string")throw new Error("Login response did not include an access token");x(n.user,N)}catch(s){c(s instanceof Error?s.message:"Login failed")}finally{l(!1)}},R=async a=>{a.preventDefault(),c(""),l(!0);try{const s=await fetch("/api/auth/verify-2fa",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pending_token:q,code:w})}),o=await s.json();if(!s.ok)throw new Error(o.detail||t("twoFactor.invalidCode"));const n=o.access_token??o.token;if(!n)throw new Error("Response did not include an access token");x(o.user,n)}catch(s){c(s instanceof Error?s.message:t("twoFactor.invalidCode")),v("")}finally{l(!1)}},A=()=>{y(!1),b(""),v(""),c("")};return e.jsxs("div",{className:"relative flex min-h-screen items-center justify-center overflow-hidden text-slate-100",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute -left-24 top-[-120px] h-[420px] w-[420px] rounded-full bg-sky-500/10 blur-3xl"}),e.jsx("div",{className:"absolute right-[-120px] top-[18%] h-[460px] w-[460px] rounded-full bg-sky-500-secondary/10 blur-[140px]"}),e.jsx("div",{className:"absolute left-[45%] bottom-[-180px] h-[340px] w-[340px] rounded-full bg-sky-500/5 blur-[120px]"})]}),e.jsx("div",{className:"relative z-10 w-full max-w-md px-4 sm:px-6",children:e.jsxs("div",{className:"card border border-slate-800 bg-slate-900/55 p-6 sm:p-10",children:[e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"glow-ring h-14 w-14 sm:h-16 sm:w-16",children:e.jsx("div",{className:"flex h-12 w-12 sm:h-14 sm:w-14 items-center justify-center rounded-full bg-slate-950 p-[2px] shadow-xl",children:e.jsx("img",{src:$,alt:"BalùHost logo",className:"h-full w-full rounded-full"})})}),e.jsx("h1",{className:"mt-5 sm:mt-6 text-2xl sm:text-3xl font-semibold tracking-wide text-slate-100",children:t("title")}),e.jsx("p",{className:"mt-2 text-sm text-slate-100-tertiary",children:t(u?"twoFactor.subtitle":"subtitle")}),e.jsx(z,{size:"md",className:"mt-3"}),i!=="checking"&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${i==="local"?"bg-emerald-400 animate-pulse":i==="ipc"?"bg-amber-400":"bg-slate-400"}`}),e.jsx("span",{className:"text-slate-100-tertiary uppercase tracking-wider",children:t(i==="local"?"connectionModes.local":i==="ipc"?"connectionModes.network":"connectionModes.fallback")})]})]}),u?e.jsxs("form",{onSubmit:R,className:"mt-8 sm:mt-10 space-y-4 sm:space-y-5",children:[d&&e.jsx("div",{className:"rounded-xl border border-rose-500/30 bg-rose-500/10 px-3 sm:px-4 py-2.5 sm:py-3 text-sm text-rose-200",children:d}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"totp-code",className:"text-xs font-medium uppercase tracking-[0.2em] text-slate-100-tertiary",children:t("twoFactor.codeLabel")}),e.jsx("input",{ref:j,type:"text",id:"totp-code",className:"input text-center text-2xl tracking-[0.5em] font-mono",value:w,onChange:a=>{const s=a.target.value.replace(/\D/g,"").slice(0,8);v(s)},placeholder:t("twoFactor.codePlaceholder"),autoComplete:"one-time-code",inputMode:"numeric",required:!0}),e.jsx("p",{className:"text-xs text-slate-100-tertiary text-center mt-1",children:t("twoFactor.useBackupCode")})]}),e.jsx("button",{type:"submit",className:"btn btn-primary w-full mt-5 sm:mt-6 touch-manipulation active:scale-[0.98]",disabled:m||w.length<6,children:t(m?"twoFactor.verifying":"twoFactor.verify")}),e.jsx("button",{type:"button",onClick:A,className:"w-full text-center text-sm text-slate-100-tertiary hover:text-slate-100-secondary transition-colors",children:t("twoFactor.backToLogin")})]}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:D,className:"mt-8 sm:mt-10 space-y-4 sm:space-y-5",children:[d&&e.jsx("div",{className:"rounded-xl border border-rose-500/30 bg-rose-500/10 px-3 sm:px-4 py-2.5 sm:py-3 text-sm text-rose-200",children:d}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"username",className:"text-xs font-medium uppercase tracking-[0.2em] text-slate-100-tertiary",children:t("form.username")}),e.jsx("input",{type:"text",id:"username",className:"input",value:f,onChange:a=>T(a.target.value),placeholder:"admin",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs font-medium uppercase tracking-[0.2em] text-slate-100-tertiary",children:[e.jsx("label",{htmlFor:"password",children:t("form.password")}),e.jsx("span",{className:"hidden sm:inline text-slate-100-tertiary normal-case tracking-normal",children:t("form.passwordHint")})]}),e.jsx("input",{type:"password",id:"password",className:"input",value:h,onChange:a=>L(a.target.value),placeholder:"••••••••",required:!0})]}),e.jsx("button",{type:"submit",className:"btn btn-primary w-full mt-5 sm:mt-6 touch-manipulation active:scale-[0.98]",disabled:m,children:t(m?"form.loading":"form.submit")})]}),B&&e.jsxs("div",{className:"mt-6 sm:mt-8 rounded-xl border border-slate-800 bg-slate-950-secondary p-3 sm:p-4 text-center text-xs text-slate-100-tertiary",children:[t("defaultCredentials")," - ",e.jsx("span",{className:"text-slate-100-secondary",children:"admin"})," / ",e.jsx("span",{className:"text-slate-100-secondary",children:"changeme"})]})]}),e.jsxs("div",{className:"mt-4 sm:mt-6 text-center text-[10px] sm:text-[11px] uppercase tracking-[0.3em] sm:tracking-[0.35em] text-slate-100-tertiary",children:[t("firmware")," v",C?"...":E||"?.?.?",!1," - ",t("systemStatus")," ",e.jsx("span",{className:"text-sky-400",children:t("optimal")})]})]})})]})}export{K as default};
